<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Заметки Будущего — Вход</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="logo">Заметки Будущего</div>
    <div id="auth-section">
      <div class="tabs">
        <button id="login-tab" class="tab active">Вход</button>
        <button id="register-tab" class="tab">Регистрация</button>
      </div>
      <form id="login-form" class="auth-form">
        <input type="email" id="login-email" placeholder="Email" required>
        <input type="password" id="login-password" placeholder="Пароль" required>
        <button type="submit">Войти</button>
        <div class="error" id="login-error"></div>
      </form>
      <form id="register-form" class="auth-form" style="display:none;">
        <input type="email" id="register-email" placeholder="Email" required>
        <input type="password" id="register-password" placeholder="Пароль" required>
        <button type="submit">Зарегистрироваться</button>
        <div class="error" id="register-error"></div>
      </form>
    </div>
    <div id="menu-section" style="display:none;">
      <div class="slogan">Ваш личный космос идей, задач и развития</div>
      <div class="links">
        <a class="card-link" href="notes.html">Заметки</a>
        <a class="card-link" href="expenses.html">Учёт расходов</a>
        <a class="card-link" href="trainings.html">Тренировки</a>
        <a class="card-link" href="goals.html">Цели</a>
        <button id="logout-btn" class="card-link" style="background:#a259ff;">Выйти</button>
      </div>
    </div>
  </div>
  <script src="common.js"></script>
  <script>
    // Переключение вкладок
    document.getElementById('login-tab').onclick = function() {
      this.classList.add('active');
      document.getElementById('register-tab').classList.remove('active');
      document.getElementById('login-form').style.display = '';
      document.getElementById('register-form').style.display = 'none';
    };
    document.getElementById('register-tab').onclick = function() {
      this.classList.add('active');
      document.getElementById('login-tab').classList.remove('active');
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = '';
    };
    // Вход
    document.getElementById('login-form').onsubmit = async function(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');
      errorDiv.textContent = '';
      try {
        const res = await login(email, password);
        if (res.access_token) {
          showMenu();
        } else {
          errorDiv.textContent = 'Ошибка входа';
        }
      } catch (err) {
        errorDiv.textContent = err.message || 'Ошибка входа';
      }
    };
    // Регистрация
    document.getElementById('register-form').onsubmit = async function(e) {
      e.preventDefault();
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const errorDiv = document.getElementById('register-error');
      errorDiv.textContent = '';
      try {
        await register(email, password);
        // После регистрации сразу логиним
        const res = await login(email, password);
        if (res.access_token) {
          showMenu();
        } else {
          errorDiv.textContent = 'Ошибка регистрации';
        }
      } catch (err) {
        errorDiv.textContent = err.message || 'Ошибка регистрации';
      }
    };
    // Выход
    document.getElementById('logout-btn').onclick = function() {
      logout();
      showAuth();
    };
    // Проверка авторизации при загрузке
    function showMenu() {
      document.getElementById('auth-section').style.display = 'none';
      document.getElementById('menu-section').style.display = '';
    }
    function showAuth() {
      document.getElementById('auth-section').style.display = '';
      document.getElementById('menu-section').style.display = 'none';
    }
    if (getToken()) {
      showMenu();
    } else {
      showAuth();
    }
  </script>
</body>
</html> 
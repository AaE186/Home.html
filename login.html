<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Заметки Будущего — Вход</title>
  <style>body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(120deg, #181c2b 0%, #232946 100%);
  font-family: 'Montserrat', Arial, sans-serif;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.container {
  background: rgba(255,255,255,0.06);
  border-radius: 1.5em;
  box-shadow: 0 4px 32px 0 rgba(0,255,240,0.08), 0 1.5px 8px 0 rgba(162,89,255,0.12);
  padding: 2.5em 2em 2em 2em;
  min-width: 320px;
  max-width: 400px;
  margin: 2em auto;
  text-align: center;
}
.logo {
  font-size: 2.2rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  margin-bottom: 0.5em;
  background: linear-gradient(90deg, #00fff0 20%, #a259ff 80%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-fill-color: transparent;
  text-shadow: 0 2px 32px #00fff055;
}
.slogan {
  font-size: 1.1rem;
  color: #b8c1ec;
  margin-bottom: 2em;
  text-align: center;
  letter-spacing: 0.04em;
}
.links {
  display: flex;
  flex-direction: column;
  gap: 1.2em;
  margin-bottom: 1.5em;
}
.card-link {
  padding: 1em 2em;
  border-radius: 1.2em;
  background: rgba(255,255,255,0.08);
  border: 1.5px solid rgba(0,255,240,0.18);
  color: #fff;
  font-size: 1.1rem;
  font-weight: 600;
  text-decoration: none;
  transition: transform 0.18s, box-shadow 0.18s, background 0.18s;
  box-shadow: 0 2px 12px 0 rgba(0,0,0,0.12);
  cursor: pointer;
}
.card-link:hover {
  transform: translateY(-4px) scale(1.03);
  background: rgba(0,255,240,0.12);
  box-shadow: 0 8px 40px 0 #00fff055, 0 2px 12px 0 #a259ff33;
}
.tabs {
  display: flex;
  justify-content: center;
  gap: 1em;
  margin-bottom: 1em;
}
.tab {
  background: none;
  border: none;
  color: #b8c1ec;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  padding: 0.5em 1.2em;
  border-radius: 1em 1em 0 0;
  transition: background 0.18s, color 0.18s;
}
.tab.active {
  background: #232946;
  color: #00fff0;
}
.auth-form {
  display: flex;
  flex-direction: column;
  gap: 1em;
  margin-bottom: 1em;
}
.auth-form input {
  padding: 0.7em 1em;
  border-radius: 0.7em;
  border: none;
  font-size: 1rem;
  background: #232946;
  color: #fff;
}
.auth-form button {
  background: linear-gradient(90deg, #00fff0 20%, #a259ff 80%);
  color: #232946;
  font-weight: 700;
  border: none;
  border-radius: 0.7em;
  padding: 0.7em 1em;
  font-size: 1.1rem;
  cursor: pointer;
  transition: background 0.18s;
}
.auth-form button:hover {
  background: linear-gradient(90deg, #a259ff 20%, #00fff0 80%);
}
.error {
  color: #ff6b6b;
  font-size: 0.95em;
  min-height: 1.2em;
}
@media (max-width: 600px) {
  .container { min-width: unset; max-width: 98vw; padding: 1.2em 0.5em; }
  .logo { font-size: 1.3rem; }
  .links { gap: 0.7em; }
  .card-link { font-size: 1rem; padding: 0.7em 1em; }
}</style>
  <!-- <link rel="stylesheet" href="main/style.css"> -->
<script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=ML_CoWkya_Tw5V6MixyDSK84mGJ0FOUOA6Emq8mDSBwNJ4U3bj12irHdPrmr6Q6l1yT6sHcm3XfsQ9vEouIflA" charset="UTF-8"></script></head>
<body>

  <div class="container">
  <div class="logo">Заметки Будущего</div>
  <div id="auth-section">
    <div class="tabs">
      <button id="login-tab" class="tab active" type="button">Вход</button>
      <button id="register-tab" class="tab" type="button">Регистрация</button>
    </div>
    <form id="login-form" class="auth-form">
      <input type="text" id="login-username" placeholder="username" required>
      <input type="password" id="login-password" placeholder="Пароль" required>
      <button type="submit">Войти</button>
      <div class="error" id="login-error"></div>
    </form>
    <form id="register-form" class="auth-form" style="display:none;">
      <input type="text" id="register-username" placeholder="username" required>
      <input type="password" id="register-password" placeholder="Пароль" required>
      <button type="submit">Зарегистрироваться</button>
      <div class="error" id="register-error"></div>
    </form>
  </div>
</div>

  <script>
document.addEventListener("DOMContentLoaded", function () {

  // Переключение вкладок
  document.getElementById('login-tab').onclick = function() {
    this.classList.add('active');
    document.getElementById('register-tab').classList.remove('active');
    document.getElementById('login-form').style.display = '';
    document.getElementById('register-form').style.display = 'none';
  };

  document.getElementById('register-tab').onclick = function() {
    this.classList.add('active');
    document.getElementById('login-tab').classList.remove('active');
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('register-form').style.display = '';
  };

  // Проверяем токен только если мы на защищенной странице
  if (window.location.pathname === "/vxod") {
    if (!getToken()) {
      window.location.href = "/login";  // или твой путь к форме входа
    }
  }

  // Вход
  document.getElementById('login-form').onsubmit = async function(e) {
    e.preventDefault();
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    const errorDiv = document.getElementById('login-error');
    errorDiv.textContent = '';
    try {
      const res = await login(username, password);
      if (res.access) {
        localStorage.setItem('access_token', res.access);
        window.location.href = '/Главная';  // после логина сразу на защищенную страницу
      } else {
        errorDiv.textContent = 'Ошибка входа';
      }
    } catch (err) {
      errorDiv.textContent = err.message || 'Ошибка входа';
    }
  };

  // Регистрация
  document.getElementById('register-form').onsubmit = async function(e) {
    e.preventDefault();
    const username = document.getElementById('register-username').value;
    const password = document.getElementById('register-password').value;
    const errorDiv = document.getElementById('register-error');
    errorDiv.textContent = '';
    try {
      await register(username, password);
      const res = await login(username, password);
      if (res.access) {
        localStorage.setItem('access_token', res.access);
        window.location.href = '/vxod';  // тоже на защищенную страницу
      } else {
        errorDiv.textContent = 'Ошибка регистрации';
      }
    } catch (err) {
      errorDiv.textContent = err.message || 'Ошибка регистрации';
    }
  };

  async function login(username, password) {
    const response = await fetch('/api/token/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    if (!response.ok) throw new Error('Неверные учетные данные');
    return await response.json();
  }

  async function register(username, password) {
    const response = await fetch('/api/register/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({username, password })
    });
    if (!response.ok) throw new Error('Ошибка регистрации');
    return await response.json();
  }

  function getToken() {
    return localStorage.getItem('access_token');
  }
});
</script>
</body>
</html>

{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <style>
    .menu-button {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 24px;
      cursor: pointer;
      background: green;
      border: none;
    }
    .sidebar {
      position: fixed;
      top: 0; left: -250px;
      width: 250px;
      height: 100%;
      background-color: #eee;
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.3);
      transition: left 0.3s ease;
      z-index: 1000;
    }
    .sidebar.active {
      left: 0;
    }
    #blurOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      backdrop-filter: blur(5px);
      background: rgba(255,255,255,0.3);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 999;
    }
    #blurOverlay.active {
      pointer-events: auto;
      opacity: 1;
    }
    .sidebar h2 {
      margin-top: 0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      margin: 10px 0;
    }

</style>
    <link rel="stylesheet" href = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'main/css/main.css'%}">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.7.2/css/all.css">
    <link rel="stylesheet" href="{% static 'main/css/main.css'%}">
<link rel="stylesheet" href="{% static 'main/css/dark-theme.css'%}">

</head>
<div id="menu-section" style="display:none;">
  <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
  <button id="logout-btn">–í—ã–π—Ç–∏</button>
</div>

<body>

    <button id="theme-toggle" class="btn btn-secondary" style="float:right;">üåô</button>
  <aside><button class="menu-button" onclick="toggleSidebar()">‚ò∞</button></aside>
  <div id="blurOverlay" onclick="toggleSidebar()"></div>
  <!--<div class="sidebar" id="sidebar"> -->
  <div class="sidebar" id="sidebar">
  <h2>–ß–µ —Ç–µ –µ—â–µ –Ω–∞–¥–æ?</h2>

  <ul id="menuList">
    <li><a href="#" id="createNewFile">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª</a></li>
    <li><a href="–ì–ª–∞–≤–Ω–∞—è">–ì–ª–∞–≤–Ω–∞—è</a></li>
    <li><a href="–§–∏–ª—å–º—ã">–§–∏–ª—å–º—ã</a></li>
    <li><a href="–ö–∞–ª–µ–Ω">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
    <li><a href="–§–∏–Ω–∞–Ω—Å—ã">–§–∏–Ω–∞–Ω—Å—ã</a></li>
    <li><a href="–ó–∞–º">–ó–∞–º–µ—Ç–∫–∏</a></li>
    <li><a href="–ü—Ä–æ–±–Ω–∏–∫2">–ü—Ä–æ–±–Ω–∏–∫2</a></li>
      <li><a href="—Ç—Ä–µ–Ω">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞></a></li>
  </ul>
</div>
     <header>

         {% if request.user.is_authenticated %}
  –ü—Ä–∏–≤–µ—Ç, {{ request.user.username }}!
  <a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a>
{% else %}
  <form method="post" action="{% url 'login' %}">
    {% csrf_token %}
    <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω">
    <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button type="submit">–í–æ–π—Ç–∏</button>
  </form>
{% endif %}


         <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è </h3>

  <h1>User: {{ user }}</h1>
    <div id="user-info"></div>



         <span id="username"></span>


<ol>
  <li><a href="–ì–ª–∞–≤–Ω–∞—è" target="_self"><i class="fa-solid fa-house"></i> –ì–ª–∞–≤–Ω–∞—è</a></li>
  <li><a href="–ö–∞–ª–µ–Ω–¥–∞—Ä—å" target="_blank">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
  <li><a href="–§–∏–ª—å–º—ã" target="_blank">–§–∏–ª—å–º—ã</a></li>
  <li><a href="–ü—Ä–æ–±–Ω–∏–∫2" target="_blank">–ü—Ä–æ–±–Ω–∏–∫2</a></li>
  <li><a href="–ó–∞–º" target="_blank">–ó–∞–º–µ—Ç–∫–∏</a></li>
  <li><a href="–§–∏–Ω–∞–Ω—Å—ã" target="_blank">–§–∏–Ω–∞–Ω—Å—ã</a></li>
  <li><a href="">–ê–±–∏–ª–æ–≤</a></li>
  <li><a href="side" target="_blank">–ú–µ–Ω—é</a></li>
  <li><a href="–±–¥–Ω–æ–≤" target="_blank">–ë–î–ù–û–í</a></li>
  <li><a href="–¢—Ä–µ–Ω" target="_blank">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</a></li>
  <li><a href="cursor" target="_blank">Cursor</a></li>
    <li><a href="login" target="_blank">–í—Ö–æ–¥</a></li>
</ol>

    </header>
    <main>
    {% block body %}
    {% endblock %}
    </main>

    <!--{% block content %} -->
    <!--{% endblock %} -->
<script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
      document.getElementById('blurOverlay').classList.toggle('active');
    }
      document.getElementById('theme-toggle').onclick = function() {
    document.body.classList.toggle('dark-theme');
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –≤ localStorage
    if(document.body.classList.contains('dark-theme')) {
      localStorage.setItem('theme', 'dark');
    } else {
      localStorage.setItem('theme', 'light');
    }
  };
  // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  if(localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-theme');
  }
  async function getCurrentUser() {
  const token = localStorage.getItem('access_token');
  if (!token) return null;

  const res = await fetch('/api/me/', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  if (!res.ok) return null;
  return await res.json();
}
document.addEventListener("DOMContentLoaded", async () => {
  const userInfoDiv = document.getElementById('user-info');
  const user = await getCurrentUser();
  if (user) {
    userInfoDiv.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.username} | Logout`;
  } else {
    userInfoDiv.textContent = `Login`;
  }
});
async function loadCurrentUser() {
  try {
    const token = localStorage.getItem('access_token');
    if (!token) {
      document.getElementById('username').textContent = 'AnonymousUser';
      return;
    }

    const response = await fetch('/api/me/', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    if (response.ok) {
      const data = await response.json();
      document.getElementById('username').textContent = data.username;
    } else {
      document.getElementById('username').textContent = 'AnonymousUser';
    }
  } catch (err) {
    document.getElementById('username').textContent = 'AnonymousUser';
  }
}

</script>
</body>
</html>
